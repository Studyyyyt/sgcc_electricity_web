# é€šç”¨ç½‘ç«™æ•°æ®æŠ“å–è½¬Home Assistantå®ä½“æ¶æ„è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºå›½å®¶ç”µç½‘ç”µåŠ›è·å–é¡¹ç›®ï¼Œæ€»ç»“äº†ä¸€å¥—é€šç”¨çš„æ¶æ„æ¨¡å¼ï¼Œå¯ä»¥å¤ç”¨äºä»»æ„ç½‘ç«™çš„æ•°æ®æŠ“å–å¹¶è½¬åŒ–ä¸ºHome Assistantå®ä½“æ˜¾ç¤ºã€‚

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Flask Webåº”ç”¨              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨                â”‚â”‚
â”‚  â”‚  (Flask-APScheduler)           â”‚â”‚
â”‚  â”‚  - å®šæ—¶è§¦å‘æ•°æ®æŠ“å–              â”‚â”‚
â”‚  â”‚  - å¯é…ç½®æ‰§è¡Œæ—¶é—´                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    ç½‘ç«™æ•°æ®æŠ“å–æ¨¡å—              â”‚â”‚
â”‚  â”‚  - æµè§ˆå™¨è‡ªåŠ¨åŒ– (Selenium)      â”‚â”‚
â”‚  â”‚  - åæ£€æµ‹æŠ€æœ¯                    â”‚â”‚
â”‚  â”‚  - éªŒè¯ç å¤„ç† (ONNX/OCR)        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    æ•°æ®å­˜å‚¨å±‚                    â”‚â”‚
â”‚  â”‚  - SQLiteæ•°æ®åº“                 â”‚â”‚
â”‚  â”‚  - æ•°æ®æ¨¡å‹è®¾è®¡                  â”‚â”‚
â”‚  â”‚  - CRUDæ“ä½œå°è£…                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    RESTful APIå±‚                â”‚â”‚
â”‚  â”‚  - Flask-RESTful               â”‚â”‚
â”‚  â”‚  - æ ‡å‡†åŒ–JSONå“åº”               â”‚â”‚
â”‚  â”‚  - é”™è¯¯å¤„ç†                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ HTTP APIè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Home Assistant              â”‚
â”‚  - RESTä¼ æ„Ÿå™¨é…ç½®                   â”‚
â”‚  - è‡ªåŠ¨å®ä½“åˆ›å»º                     â”‚
â”‚  - æ•°æ®å¯è§†åŒ–                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ (Scheduler)

**æŠ€æœ¯æ ˆ**: Flask-APScheduler
**åŠŸèƒ½**: å®šæ—¶è§¦å‘æ•°æ®æŠ“å–ä»»åŠ¡

```python
from flask_apscheduler import APScheduler

# åˆå§‹åŒ–è°ƒåº¦å™¨
scheduler = APScheduler()

# é…ç½®å®šæ—¶ä»»åŠ¡
@scheduler.task('cron', id='fetch_data_task', hour='7,19')
def fetch_data_task():
    """å®šæ—¶æ•°æ®æŠ“å–ä»»åŠ¡"""
    try:
        # æ‰§è¡Œæ•°æ®æŠ“å–
        data = data_fetcher.fetch()
        # å­˜å‚¨åˆ°æ•°æ®åº“
        for item_id, item_data in data.items():
            database.insert_data(item_id, item_data)
        logging.info("æ•°æ®æŠ“å–ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ")
    except Exception as e:
        logging.error(f"æ•°æ®æŠ“å–ä»»åŠ¡å¤±è´¥: {e}")
```

**å¤ç”¨è¦ç‚¹**:
- å¯é…ç½®æ‰§è¡Œæ—¶é—´ (`hour`, `minute`, `second`)
- æ”¯æŒcronè¡¨è¾¾å¼
- å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- ä»»åŠ¡çŠ¶æ€ç›‘æ§

### 2. ç½‘ç«™æ•°æ®æŠ“å–æ¨¡å— (Data Fetcher)

**æŠ€æœ¯æ ˆ**: Selenium + undetected_chromedriver + ONNX
**åŠŸèƒ½**: è‡ªåŠ¨åŒ–æµè§ˆå™¨æ“ä½œï¼ŒæŠ“å–ç›®æ ‡ç½‘ç«™æ•°æ®

```python
import undetected_chromedriver as uc
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class DataFetcher:
    def __init__(self, username: str, password: str):
        self._username = username
        self._password = password
        # éªŒè¯ç è¯†åˆ«æ¨¡å‹ (å¯é€‰)
        self.captcha_solver = CaptchaSolver()
    
    def _get_webdriver(self):
        """è·å–æµè§ˆå™¨é©±åŠ¨"""
        chrome_options = Options()
        chrome_options.add_argument('--headless')        # æ— å¤´æ¨¡å¼
        chrome_options.add_argument('--no-sandbox')      # æ²™ç›’æ¨¡å¼
        chrome_options.add_argument('--disable-gpu')     # ç¦ç”¨GPU
        driver = uc.Chrome(options=chrome_options)
        return driver
    
    def _login(self, driver):
        """ç™»å½•ç›®æ ‡ç½‘ç«™"""
        driver.get(LOGIN_URL)
        
        # è¾“å…¥ç”¨æˆ·åå¯†ç 
        username_input = driver.find_element(By.ID, "username")
        password_input = driver.find_element(By.ID, "password")
        username_input.send_keys(self._username)
        password_input.send_keys(self._password)
        
        # å¤„ç†éªŒè¯ç  (å¦‚æœéœ€è¦)
        if self._has_captcha(driver):
            self._solve_captcha(driver)
        
        # ç‚¹å‡»ç™»å½•
        login_button = driver.find_element(By.ID, "login-btn")
        login_button.click()
        
        # ç­‰å¾…ç™»å½•æˆåŠŸ
        WebDriverWait(driver, 30).until(
            EC.url_changes(LOGIN_URL)
        )
        return True
    
    def _extract_data(self, driver):
        """æå–ç›®æ ‡æ•°æ®"""
        data = {}
        
        # å¯¼èˆªåˆ°æ•°æ®é¡µé¢
        driver.get(DATA_URL)
        
        # æå–å…·ä½“æ•°æ® - æ ¹æ®ç›®æ ‡ç½‘ç«™å®šåˆ¶
        elements = driver.find_elements(By.CLASS_NAME, "data-item")
        for element in elements:
            item_id = element.get_attribute("data-id")
            item_value = element.text
            data[item_id] = {
                'value': item_value,
                'timestamp': datetime.now().isoformat()
            }
        
        return data
    
    def fetch(self):
        """ä¸»è¦æŠ“å–æ–¹æ³•"""
        driver = self._get_webdriver()
        try:
            if self._login(driver):
                return self._extract_data(driver)
            else:
                raise Exception("ç™»å½•å¤±è´¥")
        finally:
            driver.quit()
```

**å¤ç”¨è¦ç‚¹**:
- æ¨¡å—åŒ–è®¾è®¡: ç™»å½•ã€æ•°æ®æå–ã€éªŒè¯ç å¤„ç†åˆ†ç¦»
- é…ç½®åŒ–: URLã€é€‰æ‹©å™¨ã€ç­‰å¾…æ—¶é—´å¯é…ç½®
- é”™è¯¯å¤„ç†: ç™»å½•å¤±è´¥ã€å…ƒç´ æœªæ‰¾åˆ°ç­‰å¼‚å¸¸å¤„ç†
- åæ£€æµ‹: ä½¿ç”¨undetected_chromedriveré¿å…æ£€æµ‹

### 3. æ•°æ®å­˜å‚¨å±‚ (Database Layer)

**æŠ€æœ¯æ ˆ**: SQLite3
**åŠŸèƒ½**: æ•°æ®æŒä¹…åŒ–å­˜å‚¨å’Œç®¡ç†

```python
import sqlite3
from datetime import datetime

class DatabaseManager:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.connection = sqlite3.connect(db_path, check_same_thread=False)
        self._init_tables()
    
    def _init_tables(self):
        """åˆå§‹åŒ–æ•°æ®è¡¨"""
        cursor = self.connection.cursor()
        
        # åˆ›å»ºä¸»æ•°æ®è¡¨ - æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS main_data (
                id TEXT PRIMARY KEY,
                value REAL,
                unit TEXT,
                category TEXT,
                create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """)
        
        # åˆ›å»ºå†å²æ•°æ®è¡¨
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS historical_data (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                item_id TEXT,
                value REAL,
                timestamp TIMESTAMP,
                FOREIGN KEY (item_id) REFERENCES main_data (id)
            )
        """)
        
        self.connection.commit()
        cursor.close()
    
    def insert_data(self, item_id: str, value: float, unit: str = None, category: str = None):
        """æ’å…¥æˆ–æ›´æ–°æ•°æ®"""
        cursor = self.connection.cursor()
        
        # æ’å…¥ä¸»æ•°æ®
        cursor.execute("""
            INSERT OR REPLACE INTO main_data (id, value, unit, category, update_time)
            VALUES (?, ?, ?, ?, CURRENT_TIMESTAMP)
        """, (item_id, value, unit, category))
        
        # æ’å…¥å†å²æ•°æ®
        cursor.execute("""
            INSERT INTO historical_data (item_id, value, timestamp)
            VALUES (?, ?, CURRENT_TIMESTAMP)
        """, (item_id, value))
        
        self.connection.commit()
        cursor.close()
    
    def get_current_data(self, item_id: str):
        """è·å–å½“å‰æ•°æ®"""
        cursor = self.connection.cursor()
        cursor.execute("""
            SELECT value, unit, category, update_time 
            FROM main_data 
            WHERE id = ?
        """, (item_id,))
        
        result = cursor.fetchone()
        cursor.close()
        
        if result:
            return {
                'value': result[0],
                'unit': result[1],
                'category': result[2],
                'update_time': result[3]
            }
        return None
    
    def get_historical_data(self, item_id: str, limit: int = 7):
        """è·å–å†å²æ•°æ®"""
        cursor = self.connection.cursor()
        cursor.execute("""
            SELECT value, timestamp 
            FROM historical_data 
            WHERE item_id = ? 
            ORDER BY timestamp DESC 
            LIMIT ?
        """, (item_id, limit))
        
        results = cursor.fetchall()
        cursor.close()
        
        return [
            {'value': row[0], 'timestamp': row[1]} 
            for row in results
        ]
```

**å¤ç”¨è¦ç‚¹**:
- é€šç”¨æ•°æ®æ¨¡å‹: ä¸»æ•°æ®è¡¨ + å†å²æ•°æ®è¡¨
- CRUDæ“ä½œå°è£…
- äº‹åŠ¡å¤„ç†
- ç´¢å¼•ä¼˜åŒ–

### 4. RESTful APIå±‚

**æŠ€æœ¯æ ˆ**: Flask + Flask-RESTful
**åŠŸèƒ½**: æä¾›æ ‡å‡†åŒ–çš„HTTP APIæ¥å£

```python
from flask import Flask
from flask_restful import Api, Resource

app = Flask(__name__)
api = Api(app)

class DataResource(Resource):
    def get(self, item_id):
        """è·å–å•ä¸ªæ•°æ®é¡¹"""
        try:
            data = database.get_current_data(item_id)
            if data:
                return data, 200
            else:
                return {'error': 'Data not found'}, 404
        except Exception as e:
            return {'error': str(e)}, 500

class DataListResource(Resource):
    def get(self):
        """è·å–æ‰€æœ‰æ•°æ®é¡¹åˆ—è¡¨"""
        try:
            data_list = database.get_all_data()
            return data_list, 200
        except Exception as e:
            return {'error': str(e)}, 500

class HistoricalDataResource(Resource):
    def get(self, item_id):
        """è·å–å†å²æ•°æ®"""
        try:
            historical_data = database.get_historical_data(item_id)
            return historical_data, 200
        except Exception as e:
            return {'error': str(e)}, 500

# æ³¨å†ŒAPIè·¯ç”±
api.add_resource(DataListResource, '/api/v1/data')
api.add_resource(DataResource, '/api/v1/data/<string:item_id>')
api.add_resource(HistoricalDataResource, '/api/v1/data/<string:item_id>/history')
```

**å¤ç”¨è¦ç‚¹**:
- æ ‡å‡†åŒ–RESTfulè®¾è®¡
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- JSONå“åº”æ ¼å¼
- ç‰ˆæœ¬æ§åˆ¶ (`/api/v1/`)

## ğŸ”„ Home Assistanté›†æˆæ¨¡å¼

### 1. RESTä¼ æ„Ÿå™¨é…ç½®

```yaml
# configuration.yaml
sensor:
  # åŸºç¡€æ•°æ®ä¼ æ„Ÿå™¨
  - platform: rest
    name: "ç½‘ç«™æ•°æ®é¡¹1"
    resource: "http://your-api-server:8080/api/v1/data/item1"
    value_template: "{{ value_json.value }}"
    unit_of_measurement: "{{ value_json.unit }}"
    scan_interval: 3600  # 1å°æ—¶æ›´æ–°ä¸€æ¬¡
    
  - platform: rest
    name: "ç½‘ç«™æ•°æ®é¡¹2"
    resource: "http://your-api-server:8080/api/v1/data/item2"
    value_template: "{{ value_json.value }}"
    unit_of_measurement: "{{ value_json.unit }}"
    scan_interval: 3600

  # å†å²æ•°æ®ä¼ æ„Ÿå™¨
  - platform: rest
    name: "ç½‘ç«™æ•°æ®é¡¹1_æ˜¨æ—¥"
    resource: "http://your-api-server:8080/api/v1/data/item1/history"
    value_template: "{{ value_json[1].value }}"  # è·å–ç¬¬äºŒæ¡è®°å½•(æ˜¨æ—¥)
    scan_interval: 86400  # 1å¤©æ›´æ–°ä¸€æ¬¡
```

### 2. è‡ªåŠ¨åŒ–è§„åˆ™ç¤ºä¾‹

```yaml
# automations.yaml
automation:
  - alias: "æ•°æ®å¼‚å¸¸å‘Šè­¦"
    trigger:
      platform: numeric_state
      entity_id: sensor.wang_zhan_shu_ju_xiang_1
      above: 100  # é˜ˆå€¼
    action:
      service: notify.mobile_app_your_phone
      data:
        message: "ç½‘ç«™æ•°æ®å¼‚å¸¸: {{ states('sensor.wang_zhan_shu_ju_xiang_1') }}"
        
  - alias: "å®šæ—¶æ•°æ®æŠ¥å‘Š"
    trigger:
      platform: time
      at: "08:00:00"
    action:
      service: notify.mobile_app_your_phone
      data:
        message: >
          æ¯æ—¥æ•°æ®æŠ¥å‘Š:
          æ•°æ®é¡¹1: {{ states('sensor.wang_zhan_shu_ju_xiang_1') }}
          æ•°æ®é¡¹2: {{ states('sensor.wang_zhan_shu_ju_xiang_2') }}
```

## ğŸ› ï¸ é€šç”¨åŒ–é…ç½®æ–‡ä»¶

```yaml
# config.yaml - é€šç”¨é…ç½®æ¨¡æ¿
website:
  name: "ç›®æ ‡ç½‘ç«™åç§°"
  login_url: "https://example.com/login"
  data_url: "https://example.com/data"
  username: "your_username"
  password: "your_password"
  
scraping:
  schedule_hours: "7,19"          # å®šæ—¶æŠ“å–æ—¶é—´
  retry_times: 3                  # é‡è¯•æ¬¡æ•°
  wait_time: 10                   # ç­‰å¾…æ—¶é—´(ç§’)
  headless: true                  # æ— å¤´æ¨¡å¼
  
database:
  path: "/data/website_data.db"   # æ•°æ®åº“è·¯å¾„
  
api:
  host: "0.0.0.0"
  port: 8080
  version: "v1"
  
logging:
  level: "INFO"
  file: "/logs/scraper.log"

# æ•°æ®é¡¹é…ç½®
data_items:
  - id: "item1"
    name: "æ•°æ®é¡¹1"
    selector: "#data-item-1"      # CSSé€‰æ‹©å™¨
    unit: "å•ä½"
    category: "ç±»åˆ«1"
    
  - id: "item2" 
    name: "æ•°æ®é¡¹2"
    selector: ".data-value"
    unit: "å•ä½2"
    category: "ç±»åˆ«2"
```

## ğŸ“ é¡¹ç›®ç»“æ„æ¨¡æ¿

```
universal_web_scraper/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ config.py              # é…ç½®æ–‡ä»¶è§£æ
â”œâ”€â”€ scraper/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_fetcher.py        # åŸºç¡€æŠ“å–ç±»
â”‚   â”œâ”€â”€ captcha_solver.py      # éªŒè¯ç å¤„ç†
â”‚   â””â”€â”€ site_specific.py       # ç‰¹å®šç½‘ç«™å®ç°
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ manager.py             # æ•°æ®åº“ç®¡ç†
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ resources.py           # APIèµ„æº
â”‚   â””â”€â”€ app.py                 # Flaskåº”ç”¨
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py              # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ helpers.py             # è¾…åŠ©å‡½æ•°
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt           # ä¾èµ–åŒ…
â”œâ”€â”€ config.yaml               # é…ç½®æ–‡ä»¶
â””â”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æŒ‡å—

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config.yaml.example config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim config.yaml
```

### 3. å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨APIæœåŠ¡
python main.py

# æˆ–ä½¿ç”¨Docker
docker-compose up -d
```

### 4. Home Assistanté…ç½®
```yaml
# æ·»åŠ åˆ°configuration.yaml
sensor: !include sensors.yaml

# é‡å¯Home Assistant
```

## ğŸ¯ å¤ç”¨æŒ‡å—

### é€‚ç”¨åœºæ™¯
1. **éœ€è¦å®šæœŸæŠ“å–æ•°æ®çš„ç½‘ç«™**
2. **éœ€è¦ç™»å½•è®¤è¯çš„ç½‘ç«™**
3. **æœ‰éªŒè¯ç çš„ç½‘ç«™**
4. **éœ€è¦åœ¨Home Assistantä¸­æ˜¾ç¤ºæ•°æ®**

### è‡ªå®šä¹‰æ­¥éª¤
1. **ä¿®æ”¹æŠ“å–é€»è¾‘**: æ ¹æ®ç›®æ ‡ç½‘ç«™è°ƒæ•´`site_specific.py`
2. **é…ç½®æ•°æ®é¡¹**: åœ¨`config.yaml`ä¸­å®šä¹‰æ•°æ®é¡¹
3. **è°ƒæ•´æ•°æ®æ¨¡å‹**: æ ¹æ®æ•°æ®ç»“æ„ä¿®æ”¹æ•°æ®åº“è¡¨
4. **è®¾ç½®APIç«¯ç‚¹**: æ ¹æ®éœ€è¦æ·»åŠ APIæ¥å£
5. **é…ç½®HAä¼ æ„Ÿå™¨**: åœ¨Home Assistantä¸­æ·»åŠ ä¼ æ„Ÿå™¨

### æ³¨æ„äº‹é¡¹
1. **éµå®ˆç½‘ç«™æ¡æ¬¾**: ç¡®ä¿æŠ“å–è¡Œä¸ºç¬¦åˆç½‘ç«™ä½¿ç”¨æ¡æ¬¾
2. **é¢‘ç‡æ§åˆ¶**: é¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
4. **æ•°æ®éªŒè¯**: éªŒè¯æŠ“å–æ•°æ®çš„æ­£ç¡®æ€§
5. **å®‰å…¨æ€§**: ä¿æŠ¤ç™»å½•å‡­æ®å’Œæ•æ„Ÿæ•°æ®

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç›‘æ§
```python
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('scraper.log'),
        logging.StreamHandler()
    ]
)

# è®°å½•å…³é”®äº‹ä»¶
logger.info("å¼€å§‹æ•°æ®æŠ“å–")
logger.error("æŠ“å–å¤±è´¥: %s", error_message)
logger.info("æ•°æ®å­˜å‚¨æˆåŠŸ")
```

### å¥åº·æ£€æŸ¥
```python
@app.route('/health')
def health_check():
    """å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    try:
        # æ£€æŸ¥æ•°æ®åº“è¿æ¥
        database.test_connection()
        
        # æ£€æŸ¥æœ€è¿‘æ•°æ®æ›´æ–°æ—¶é—´
        last_update = database.get_last_update_time()
        if (datetime.now() - last_update).hours > 25:
            return {'status': 'warning', 'message': 'æ•°æ®æ›´æ–°å»¶è¿Ÿ'}, 200
        
        return {'status': 'healthy'}, 200
    except Exception as e:
        return {'status': 'error', 'message': str(e)}, 500
```

## ğŸ”š æ€»ç»“

è¿™å¥—æ¶æ„æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ã€å¯å¤ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå°†ä»»æ„ç½‘ç«™çš„æ•°æ®è½¬åŒ–ä¸ºHome Assistantå®ä½“ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œé…ç½®åŒ–ç®¡ç†ï¼Œå¯ä»¥å¿«é€Ÿé€‚é…ä¸åŒçš„ç›®æ ‡ç½‘ç«™ï¼Œå®ç°è‡ªåŠ¨åŒ–æ•°æ®é‡‡é›†å’Œæ™ºèƒ½å®¶å±…é›†æˆã€‚

æ ¸å¿ƒä¼˜åŠ¿ï¼š
- **é€šç”¨æ€§å¼º**: é€‚ç”¨äºå„ç§ç½‘ç«™ç»“æ„
- **å¯æ‰©å±•æ€§å¥½**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ‰©å±•
- **ç»´æŠ¤æ€§å¼º**: é…ç½®åŒ–ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤
- **ç¨³å®šæ€§é«˜**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **é›†æˆæ€§å¥½**: ä¸Home Assistantæ— ç¼é›†æˆ
